\vspace*{-1mm}

\section{Emittance}

\textbf{Defintion 1}: The statistical emittance is expressed in terms of the beam distribution: % Wolski Eq. (4.101)

\begin{equation}\label{eq:statistical_definition_emit}
    \epsilon_x^{\mathrm{geom}} = \sqrt{\langle x^2 \rangle - \langle px^2 \rangle - \langle x px \rangle^2}.
\end{equation}
This is the geometric emittance. 
\begin{equation}\label{eq:emit_geom_norm_relation}
    \epsilon_x = \epsilon_x^{\mathrm{geom}} \betarel \gammarel.
\end{equation}


\textbf{Defintion 2}:
For a gaussian beam distribution the normalised beam emittance it applies:
\begin{equation}\label{eq:emit_from_beam_size}
    \epsilon_{x} = \frac{\sigma_x(s)^2 - \delta^2 D_x^2(s)}{\beta_x(s)} \betarel \gammarel
\end{equation}

where $\sigma_x(s)$ is the beam size, $\beta_x(s)$ is the beta function, $D_x(s)$ is the dispersion fat a specific location s along the accelerator, $\delta=\Delta p/p0$ is the momentum spread and $\betarel, \gammarel$ the relativistic parameters. Similar expression is valid for the vertical plane, with the difference that there is no dispersion.

\section{Transfer maps}
Need to mention them briefly as you refer to them at the PyHEADTAIL section.

% Courant snyder formalism of longitudinal dynamics: https://journals.aps.org/prab/pdf/10.1103/PhysRevAccelBeams.24.094001
\section{Action angle variables}
The action for the x-plane is:

\begin{equation}\label{eq:action}
    \Jx = \frac{1}{2}(x_n^2 +xp^2_n) 
\end{equation}
where 
\begin{equation}\label{normalised_y}
    x_n = \frac{x}{\sqrt{\beta_x}}, \ \ xp_n = \frac{\alpha_x x}{\sqrt{\beta_x}} + \sqrt{\beta_x}xp
\end{equation}
the normalised coordinates and $\alpha_y, \beta_y$ the twiss parameters. 
The same applies for the y-plane. 

s
The statistical geometric emittance equals the average of the actions distribution:
\begin{equation}\label{eq:geom_emit_actions}
    \emitxgeom = \langle \Jx \rangle
\end{equation}
%\begin{equation}\label{eq:geom_emit_actions}
%    \epsilon_x^{\mathrm{geom}} = \langle \Jx \rangle
%\end{equation}
The distribution of actions is an exponential distribution (further explanation needed?). Therefore, its mean equals its standard deviation. (this property is used in the appendix for the computation of the rms tune spread.)

From Eq.~\eqref{eq:action} we write:
\begin{equation}\label{eq:Jy_exp_distr}
    e^{-J/\epsilon} = e^{(-x^2/2\epsilon - px^2/2\epsilon)}
\end{equation}
From this equation it can be seen that the actions follow an exponential distribution. 

\section{Wakefields and impedances}\label{sec:wakefields_theory}

he terms dipolar and quadrupolar have been chosen as the dipolar wake function acts on the test proton like a dipole magnet (the kick is the same whatever its transverse location), whereas the quadrupolar term acts like a quadrupole magnet (the kick increases linearly with the transverse offset of the test particle). Benoits thesis p.44


\section{Tracking simulation codes}\label{sec:simualtion_codes}
In this section the two tracking simulation codes used in this thesis to study the noise-induced emittance growth are presented. Both codes are macroparticle tracking libraries that simulate the particle motion in the six-dimensional (6D) phase space $(x, p_x, y, p_y, z, \delta)$. The first code performs tracking between interaction points around a circular accelerator with the use of trasnfer matrices while the second one uses the detailed optics model of the machine.

\subsection{PyHEADTAIL}\label{subsec:pyheadtail}

PyHEADTAIL~\cite{pyheadtail_repository} is an open-source 6D macroparticle tracking code, developed at CERN, which was originally designed to study collective effects in circular machines and to be easily extrensible with custom elements. 
% https://indico.cern.ch/event/930271/contributions/3910265/attachments/2066139/3467770/30June2020_Simulations_emit_growthCC_RFnoise.pdf  
Details on its implementation and its features can be find in Refs.~\cite{pyheadtail_manual_adrian, pyheadtail_schenk}. Below the main steps of a simulation are listed:

% Thesis david: https://cds.cern.ch/record/2707064/files/CERN-THESIS-2019-272.pdf (p.45) and for the transverse matrix.

\begin{enumerate}
    \item \textbf{Machine initialisation:} The accelerator ring is represented by an one-turn map splitted into a number of segments of equal length, after each of which there is an interaction point (IP). At the interaction points the macroparticles experience kicks from various accelerator components (feedback system, multipoles etc) or from collective effects such as the wakefields.
    \item \textbf{Bunch initialisation:}  A particle bunch is represented by a collection of macroparticles, each of which represents a clustered collection of physical particles. Each macroparticle is described by four transverse $(x, x^\prime, y, y^\prime)$ and two longitudinal coordinates $(z, \delta)$, a mass and an electric charge. For the studies presented in this thesis $10^{5}$ macroparticles are sufficient for an accurate represantation of the bunch, unless it is stated otherwise.
    \item \textbf{Transverse tracking}: In the transverse plane, the macroparticles are transported from one interaction point to another by linear transfer matrices which take into account the optics parameters at the beginning and the end of the respective segment \textcolor{red}{[Reference to transverse map in section above.]} For example the linear map from IP0 to IP1 is given by:
        \begin{equation}
            x=y
        \end{equation}
    \item \textbf{Chromaticity and detuning with transverse amplitude:} The chromaticity (up to higher orders) and amplitude detuning are implemented as a change of the phase advance of each individual particle and they are included in the linear map of the transverse tracking mentioned in the previous step. For example, the change of the phase advance for a macroparticle $i$ from 
    \item \textbf{Longitudinal tracking:}  The tracking in the logitudinal plane is performed with linear or non-linear synchrotron motion using the equations of motion \textcolor{red}{(Hills equation write here)}.
    \item \textbf{Impedance effects:}
    \item \textbf{Data acquisition:} The updated bunch coordinates after each turn are available at IP0 for post processing. Typically, $10^{5}$ turns are required for the noise-induced emittance growth simulation presented in this thesis. 
    
\end{enumerate}


 Last, the tracking in logitudinal plane is performed with linear or non-linear synchrotron motion. In this thesis, a linear longitudinal one-turn map is used represented by a Courant-Snyder trasnfer matrix and using only the linear first order slippage factor. %Last sentence from (LinearMap): https://github.com/PyCOMPLETE/PyHEADTAIL/blob/master/PyHEADTAIL/trackers/longitudinal_tracking.py
%or longutidanl equations of motion: slide 37 https://www2.kek.jp/accl/legacy/seminar/file/PyHEADTAIL_PyECLOUD_2.pdf

Figure~\ref{fig:pyheadtail_accelerator_model} shows a graphic representation of the accelerator model and the tracking procedure.
% Graph is created app.diagrams.net and is saved in goodle dirve.

\begin{figure}[!h]
    \centering         
    \includegraphics[width=0.6\textwidth]{images/Ch2/accelerator_model_graph_pyheadtail.png}
        \caption{Graphic represantation of the accelerator model and tracking procedure in PyHEADTAIL (inspered by the graphs in Refs.~\cite{pyheadtail_schenk, inproceedings_ibs_pyheadtail}). In this example the ring is splitted in four segments. The blue points correspond to the interaction points while the curved arrow shows the direction of the beam during the tracking.}
        \label{fig:pyheadtail_accelerator_model}
 \end{figure}

 The impedance effect in PyHEADTAIL simulations is typically implemented as a single wakefield kick per turn at one of the interaction points. Therefore, the wakefield kicks must represent the total imepdance of the full machine..
 
 implemented as wakefield kicks (in time domain) on the particles at one of the interaction points. The wakefield kick is applied in one location of the ring and it represents the total imepdance of the full machine. 

 Wakefields can be read from tables or computd from resonator models. here they are imported from table form the sps impedance model (more in \dots)

 -slices
 - considers average beta function


\subsection{Sixtracklib}\label{subsec:sixtracklib}
%Introduction to sixtrackib: https://indico.cern.ch/event/833895/contributions/3577803/attachments/1927226/3190636/intro_sixtracklib.pdf
% https://inspirehep.net/files/6273430c727ace3796a92d069f651ade